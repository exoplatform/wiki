<?xml version="1.0" encoding="UTF-8"?>
<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
  <modelVersion>4.0.0</modelVersion>
  <parent>
    <artifactId>wiki</artifactId>
    <groupId>org.exoplatform.wiki</groupId>
    <version>4.0.0.Alpha1-kill-exobuild-SNAPSHOT</version>
  </parent>
  <artifactId>wiki-webapp</artifactId>
  <packaging>war</packaging>
  <name>eXo Wiki Webapp</name>
  <properties>
    <gwt.style>DETAILED</gwt.style>
    <gwt.output.directory>${project.build.directory}/${project.build.finalName}/resources/js/xwiki/wysiwyg</gwt.output.directory>
    <xwe.directory>${gwt.output.directory}/xwe</xwe.directory>
    <xwe.module>org.xwiki.gwt.wysiwyg.WysiwygDev</xwe.module>
  </properties>
  <dependencies>
    <dependency>
      <groupId>org.exoplatform.kernel</groupId>
      <artifactId>exo.kernel.container</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.portal</groupId>
      <artifactId>exo.portal.component.portal</artifactId>
      <exclusions>
        <exclusion>
          <artifactId>pull-parser</artifactId>
          <groupId>pull-parser</groupId>
        </exclusion>
      </exclusions>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.portal</groupId>
      <artifactId>exo.portal.webui.eXo</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.portal</groupId>
      <artifactId>exo.portal.webui.portal</artifactId>
    </dependency>
    <dependency>
      <groupId>com.google.gwt</groupId>
      <artifactId>gwt-dev</artifactId>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.portal</groupId>
      <artifactId>exo.portal.webui.core</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.commons</groupId>
      <artifactId>commons-webui-ext</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.commons</groupId>
      <artifactId>commons-component-common</artifactId>
      <scope>runtime</scope>
    </dependency>
    <dependency>
      <groupId>org.xwiki.commons</groupId>
      <artifactId>xwiki-commons-context</artifactId>
    </dependency>
    <dependency>
      <groupId>org.gatein.common</groupId>
      <artifactId>common-logging</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.portal</groupId>
      <artifactId>exo.portal.component.common</artifactId>
    </dependency>    
    <dependency>
      <groupId>org.exoplatform.portal</groupId>
      <artifactId>exo.portal.component.web.server</artifactId>
    </dependency>
    <dependency>
      <groupId>org.xhtmlrenderer</groupId>
      <artifactId>flying-saucer-pdf</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.portal</groupId>
      <artifactId>exo.portal.component.web.controller</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.core</groupId>
      <artifactId>exo.core.component.organization.api</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.core</groupId>
      <artifactId>exo.core.component.security.core</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.portal</groupId>
      <artifactId>exo.portal.webui.portlet</artifactId>
    </dependency>
    <dependency>
      <groupId>javax.portlet</groupId>
      <artifactId>portlet-api</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.portal</groupId>
      <artifactId>exo.portal.component.web.resources</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.kernel</groupId>
      <artifactId>exo.kernel.commons</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.jcr</groupId>
      <artifactId>exo.jcr.component.core</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.jcr</groupId>
      <artifactId>exo.jcr.component.ext</artifactId>
      <scope>runtime</scope>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.portal</groupId>
      <artifactId>exo.portal.webui.framework</artifactId>
    </dependency>
    <dependency>
      <groupId>org.xwiki.rendering</groupId>
      <artifactId>xwiki-rendering-api</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.wiki</groupId>
      <artifactId>wiki-renderer</artifactId>
    </dependency>
    <dependency>
      <groupId>org.exoplatform.wiki</groupId>
      <artifactId>wiki-service</artifactId>
      <exclusions>
        <exclusion>
          <artifactId>pull-parser</artifactId>
          <groupId>pull-parser</groupId>
        </exclusion>
      </exclusions>
    </dependency>
    <!-- GWT core dependencies -->
    <dependency>
      <groupId>com.google.gwt</groupId>
      <artifactId>gwt-servlet</artifactId>
    </dependency>
    <!-- GWT libraries -->
    <dependency>
      <groupId>junit</groupId>
      <artifactId>junit</artifactId>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>org.mockito</groupId>
      <artifactId>mockito-all</artifactId>
      <scope>test</scope>
    </dependency>
    <dependency>
      <groupId>javax.servlet</groupId>
      <artifactId>servlet-api</artifactId>
      <scope>provided</scope>
    </dependency>
    <dependency>
      <groupId>com.google.gwt</groupId>
      <artifactId>gwt-user</artifactId>
      <scope>runtime</scope>
    </dependency>
    <!--This dependencies is used for main classes compilation but is erroneously reported as useless by mvn dependency:analyze-->
    <dependency>
      <groupId>commons-lang</groupId>
      <artifactId>commons-lang</artifactId>
    </dependency>
    <!-- This dependency is used with compile scope for the gwt plugin but reported as useless by mvn dependency:analyze -->
    <dependency>
      <groupId>org.xwiki.platform</groupId>
      <artifactId>xwiki-platform-wysiwyg-client</artifactId>
    </dependency>
    <!-- This dependency is used with compile scope for the gwt plugin but reported as useless by mvn dependency:analyze -->
    <dependency>
      <groupId>org.xwiki.platform</groupId>
      <artifactId>xwiki-platform-gwt-dom</artifactId>
    </dependency>
    <dependency>
      <groupId>org.slf4j</groupId>
      <artifactId>slf4j-simple</artifactId>
      <scope>test</scope>
    </dependency>
    <!-- This dependency is used with compile scope for the gwt plugin but reported as useless by mvn dependency:analyze -->
    <dependency>
      <groupId>com.smartgwt</groupId>
      <artifactId>smartgwt</artifactId>
    </dependency>
    <!-- This dependency is used with compile scope for the gwt plugin but reported as useless by mvn dependency:analyze -->
    <dependency>
      <groupId>org.xwiki.platform</groupId>
      <artifactId>xwiki-platform-wysiwyg-plugin-api</artifactId>
    </dependency>
    <!-- This dependency is used with compile scope for the gwt plugin but reported as useless by mvn dependency:analyze -->
    <dependency>
      <groupId>org.xwiki.platform</groupId>
      <artifactId>xwiki-platform-gwt-user</artifactId>
    </dependency>
  </dependencies>
  <build>
    <finalName>wiki</finalName>
    <plugins>
      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>gwt-maven-plugin</artifactId>
        <executions>
          <execution>
            <goals>
              <goal>compile</goal>
            </goals>
          </execution>
        </executions>
        <configuration>
          <module>${xwe.module}</module>
          <webappDirectory>${gwt.output.directory}</webappDirectory>
          <style>${gwt.style}</style>
          <disableCastChecking>true</disableCastChecking>
          <disableClassMetadata>true</disableClassMetadata>
          <soyc>false</soyc>
          <extraJvmArgs>-Xmx1024m -Xss1024k -Djava.awt.headless=true</extraJvmArgs>
        </configuration>
      </plugin>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-dependency-plugin</artifactId>
        <executions>
          <execution>
            <id>unpack-dependencies</id>
            <phase>prepare-package</phase>
            <goals>
              <goal>unpack</goal>
            </goals>
            <configuration>
              <artifactItems>
                <artifactItem>
                  <groupId>com.smartgwt</groupId>
                  <artifactId>smartgwt</artifactId>
                  <type>jar</type>
                  <outputDirectory>${project.build.directory}/smartclient</outputDirectory>
                </artifactItem>
              </artifactItems>
            </configuration>
          </execution>
        </executions>
      </plugin>
      <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-war-plugin</artifactId>
        <configuration>
          <webResources>
            <!-- Add SmartClient skins -->
            <resource>
              <directory>${project.build.directory}/smartclient/com/smartclient/theme/enterprise/public/sc/skins</directory>
              <targetPath>resources/js/xwiki/wysiwyg/xwe/sc/skins</targetPath>
              <filtering>false</filtering>
            </resource>
          </webResources>
          <!--
            We exclude the SmartClient JavaScript files which are provided by the final distribution war. We also
            exclude the deployable but not servable files generated by the GWT compiler.
            Don't include libraries into Web Archives 
          -->
          <packagingExcludes>WEB-INF/lib/*.jar,**/gwt-unitCache/*</packagingExcludes>
        </configuration>
      </plugin>
      <plugin>
        <!-- JavaScript and CSS files compression and concatenation -->
        <groupId>net.sf.alchim</groupId>
        <artifactId>yuicompressor-maven-plugin</artifactId>
        <executions>
          <execution>
            <id>aggregate-css</id>
            <!-- Compress and aggregate the CSS files after the GWT code is compiled, just before packaging the war. -->
            <phase>prepare-package</phase>
            <goals>
              <goal>compress</goal>
            </goals>
            <configuration>
              <sourceDirectory>${xwe.directory}/stylesheets</sourceDirectory>
              <outputDirectory>${xwe.directory}/stylesheets</outputDirectory>
              <!-- A hack to not include js and css files in /javascript and /skin  -->
              <warSourceDirectory>${basedir}/src/main/webapp/templates</warSourceDirectory>
              <aggregations>
                <aggregation>
                  <removeIncluded>true</removeIncluded>
                  <!-- If we overwrite directly Wysiwyg.css then it's content is not included in the aggregation. -->
                  <output>${xwe.directory}/stylesheets/Wysiwyg-all.css</output>
                  <includes>
                    <include>*.css</include>
                  </includes>
                  <excludes>
                    <!--
                      RichTextArea.css is included by the editing template and applies only to the edited content
                      (the document of the in-line frame). The rest of the CSS files are applied to the page hosting the
                      WYSIWYG editor (the document that contains the in-line frame).
                    -->
                    <exclude>RichTextArea.css</exclude>
                  </excludes>
                </aggregation>
                <!-- 
                <aggregation>
                  <removeIncluded>true</removeIncluded>
                  <output>${xwe.directory}/stylesheets/Wysiwyg.css</output>
                  <includes>
                    <include>Wysiwyg-all.css</include>
                  </includes>
                </aggregation>
                -->
              </aggregations>
            </configuration>
          </execution>
        </executions>
        <configuration>
          <!-- Overwrite the resource files with the minimized version. -->
          <nosuffix>true</nosuffix>
        </configuration>
      </plugin>
    </plugins>
  </build>
  <profiles>
    <profile>
      <id>exo-release</id>
      <properties>
        <gwt.style>OBF</gwt.style>
        <xwe.module>org.xwiki.gwt.wysiwyg.Wysiwyg</xwe.module>
      </properties>
    </profile>
    <profile>
      <id>test</id>
      <properties>
        <gwt.style>OBF</gwt.style>
        <xwe.module>org.xwiki.gwt.wysiwyg.Wysiwyg</xwe.module>
      </properties>
    </profile>
    <profile>
      <id>dev</id>
      <properties>
        <gwt.style>DETAILED</gwt.style>
        <xwe.module>org.xwiki.gwt.wysiwyg.WysiwygDev</xwe.module>
      </properties>
    </profile>
  </profiles>
</project>
